---
import Layout from '../../layouts/Main.astro';
import ProductCard from '../../components/ProductCard.astro';
import ProductosRelacionados from '../../components/ProductosRelacionados.astro';

// Datos de productos de oro
const products = await fetch ("http://localhost:8080/productos/bisuteria")//ir cambiando
.then(res=>{return res.json()})
---

<Layout title="Joyas de Oro | Tu Joyería">
  
  <section class="relative h-64 overflow-hidden">
    <div class="absolute inset-0 flex flex-col justify-center items-center bg-black/30 text-center">
      <h1 class="mb-2 font-serif text-white text-4xl">Bisuteria</h1>
      <p class="max-w-lg text-white">Descubre nuestras piezas exclusivas de bisuteria, elaboradas con las cuentas más delicadas y mejores calidades para momentos especiales</p>
    </div>
  </section>

  <section class="px-4 py-12">
    <div class="mx-auto container">
      <div class="gap-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4" id="productsContainer">
        {products.map((product) => (
          <ProductCard 
              id={product.id}
              image={product.image}
              title={product.title}
              description={product.description}
              price={product.price}
            />
        ))}
      </div>
      
  </section>

</Layout>


<script>
  // Script para filtrado y ordenación de productos
  document.addEventListener('DOMContentLoaded', () => {
    const productosContainer = document.getElementById('productsContainer');
    const productosItems = Array.from(productosContainer.children);
    const sinResultados = document.getElementById('sinResultados');
    const filtroNombre = document.getElementById('filtroNombre');
    const filtroPrecio = document.getElementById('filtroPrecio');
    const resetFiltros = document.getElementById('resetFiltros');
    
    function filtrarYOrdenarProductos() {
      const terminoBusqueda = filtroNombre.value.toLowerCase();
      const opcionOrden = filtroPrecio.value;
      let productosVisibles = 0;
      
      productosItems.forEach(item => {
        const nombre = item.querySelector('h3').textContent.toLowerCase();
        const visible = nombre.includes(terminoBusqueda);
        
        if (visible) {
          item.style.display = '';
          productosVisibles++;
        } else {
          item.style.display = 'none';
        }
      });
      
      sinResultados.classList.toggle('hidden', productosVisibles > 0);
      
      if (opcionOrden !== 'relevancia') {
        const productosArray = productosItems.filter(item => 
          item.style.display !== 'none'
        );
        
        productosArray.sort((a, b) => {
          const nombreA = a.querySelector('h3').textContent;
          const nombreB = b.querySelector('h3').textContent;
          const precioA = parseFloat(a.querySelector('p:last-child').textContent);
          const precioB = parseFloat(b.querySelector('p:last-child').textContent);
          
          switch(opcionOrden) {
            case 'precioAsc': return precioA - precioB;
            case 'precioDesc': return precioB - precioA;
            case 'nombreAsc': return nombreA.localeCompare(nombreB);
            case 'nombreDesc': return nombreB.localeCompare(nombreA);
            default: return 0;
          }
        });
        
        productosArray.forEach(item => productosContainer.appendChild(item));
      }
    }
    
    // Event listeners
    filtroNombre.addEventListener('input', filtrarYOrdenarProductos);
    filtroPrecio.addEventListener('change', filtrarYOrdenarProductos);
    
    resetFiltros.addEventListener('click', () => {
      filtroNombre.value = '';
      filtroPrecio.value = 'relevancia';
      productosItems.forEach(item => item.style.display = '');
      sinResultados.classList.add('hidden');
    });
    
    // Añadir al carrito
    const botonesCarrito = document.querySelectorAll('.product-card');
    botonesCarrito.forEach(boton => {
      boton.addEventListener('click', (e) => {
        const title = boton.querySelector('h3').textContent;
        console.log(`Producto ${title} añadido al carrito`);
        
        const notificacion = document.createElement('div');
        notificacion.className = 'fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-md shadow-lg z-50 animate-fade-in-out';
        notificacion.textContent = '¡Producto añadido al carrito!';
        document.body.appendChild(notificacion);
        
        setTimeout(() => notificacion.remove(), 3000);
      });
    });
  });
</script>

<!--{
    id: 32,
    title: "Collar de Bisuteria.",
    price: "40.99 €",
    description: "Collar de bisuteria con cuentas de colores. Ajustable y con cierre de seguridad.",
    image: "/public/imagenes/bisuteria/32.bisu.jpg"
  },
  {
    id: 33,
    title: "Pulsera de Bisuteria",
    price: "53.99 €",
    description: "Pulsera de bisuteria con cierre regulable y materiales de calidad y distintos colores.",
    image: "/public/imagenes/bisuteria/33.bisu.jpg"
  },
  {
    id: 34,
    title: "Pendientes Multicolores.",
    price: "47.99 €",
    description: "Pendientes de bisuteria con espirales y cuentas de colores.",
    image: "/public/imagenes/bisuteria/34.bisu.jpg"
  },
  {
    id: 35,
    title: "Anillo de Bisuteria multicolor.",
    price: "50.99 €",
    description: "Anillo de bisuteria con distintos colores y diseño en espiral.",
    image: "/public/imagenes/bisuteria/35.bisu.jpg"
  },
  {
    id: 36,
    title: "Tiara de pelo.",
    price: "60.99 €",
    description: "Elegante tiara de pelo con disstintos colores y cuentas de la mejor calidad.",
    image: "/public/imagenes/bisuteria/36.bisu.jpg"
  },
  {
    id: 37,
    title: "Pendientes con Espirales.",
    price: "60.99 €",
    description: "Pendientes de colores con estilo espiral y perla al final.",
    image: "/public/imagenes/bisuteria/37.bisu.jpg"
  },
  {
    id: 38,
    title: "Pulsera Multicolor.",
    price: "57.99 €",
    description: "Pulsera multicolor y ajustable.",
    image: "/public/imagenes/bisuteria/38.bisu.jpg"
  },
  {
    id: 39,
    title: "Anillo de Espiral.",
    price: "40.99 €",
    description: "Anillo esperial con cuentas multicolor y ajustable.",
    image: "/public/imagenes/bisuteria/39bisu.jpg"
  },
  {
    id: 40,
    title: "Tiara de Colores Verdes.",
    price: "60.99 €",
    description: "Tiara de pelo con tonalidades verdes y cuentas de la mejor calidad.",
    image: "/public/imagenes/bisuteria/40.bisu.jpg"
  } -->
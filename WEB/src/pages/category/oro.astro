---
import Layout from '../../layouts/Main.astro';
import ProductCard from '../../components/ProductCard.astro';
import ProductosRelacionados from '../../components/ProductosRelacionados.astro';


<<<<<<< Updated upstream
// Datos de productos de oro
const products = await fetch ("http://localhost:8080/productos/oro")//ir cambiando
=======
const products = await fetch ("http://localhost:8080/productos/oro")
>>>>>>> Stashed changes
.then(res=>{return res.json()})
---

<Layout title="Joyas de Oro | Tu Joyería">
  
<<<<<<< Updated upstream
  
  <!-- Banner Categoría -->
=======
>>>>>>> Stashed changes
  <section class="relative h-64 overflow-hidden">
    <div class="absolute inset-0 flex flex-col justify-center items-center bg-black/30 text-center">
      <h1 class="mb-2 font-serif text-white text-4xl">Colección de Oro</h1>
      <p class="max-w-lg text-white">Descubre nuestras piezas exclusivas en oro, elaboradas con los materiales más finos para momentos especiales</p>
    </div>
  </section>

  <section class="px-4 py-12">
    <div class="mx-auto container">
      <div class="gap-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4" id="productsContainer">
        {products.map((product) => (
          <ProductCard 
              id={product._id}
              image={product.image}
              title={product.title}
              description={product.description}
              price={product.price}
            />
        ))}
      </div>
      
  </section>


</Layout>


<script>
  // Script para filtrado y ordenación de productos
  document.addEventListener('DOMContentLoaded', () => {
    const productosContainer = document.getElementById('productsContainer');
    const productosItems = products;
    const sinResultados = document.getElementById('sinResultados');
    const filtroNombre = document.getElementById('filtroNombre');
    const filtroPrecio = document.getElementById('filtroPrecio');
    const resetFiltros = document.getElementById('resetFiltros');
    
    function filtrarYOrdenarProductos() {
      const terminoBusqueda = filtroNombre.value.toLowerCase();
      const opcionOrden = filtroPrecio.value;
      let productosVisibles = 0;
      
      productosItems.forEach(item => {
        const nombre = item.querySelector('h3').textContent.toLowerCase();
        const visible = nombre.includes(terminoBusqueda);
        
        if (visible) {
          item.style.display = '';
          productosVisibles++;
        } else {
          item.style.display = 'none';
        }
      });
      
      sinResultados.classList.toggle('hidden', productosVisibles > 0);
      
      if (opcionOrden !== 'relevancia') {
        const productosArray = productosItems.filter(item => 
          item.style.display !== 'none'
        );
        
        productosArray.sort((a, b) => {
          const nombreA = a.querySelector('h3').textContent;
          const nombreB = b.querySelector('h3').textContent;
          const precioA = parseFloat(a.querySelector('p:last-child').textContent);
          const precioB = parseFloat(b.querySelector('p:last-child').textContent);
          
          switch(opcionOrden) {
            case 'precioAsc': return precioA - precioB;
            case 'precioDesc': return precioB - precioA;
            case 'nombreAsc': return nombreA.localeCompare(nombreB);
            case 'nombreDesc': return nombreB.localeCompare(nombreA);
            default: return 0;
          }
        });
        
        productosArray.forEach(item => productosContainer.appendChild(item));
      }
    }
    
    // Event listeners
    filtroNombre.addEventListener('input', filtrarYOrdenarProductos);
    filtroPrecio.addEventListener('change', filtrarYOrdenarProductos);
    
    resetFiltros.addEventListener('click', () => {
      filtroNombre.value = '';
      filtroPrecio.value = 'relevancia';
      productosItems.forEach(item => item.style.display = '');
      sinResultados.classList.add('hidden');
    });
    
    // Añadir al carrito
    const botonesCarrito = document.querySelectorAll('.product-card');
    botonesCarrito.forEach(boton => {
      boton.addEventListener('click', (e) => {
        const title = boton.querySelector('h3').textContent;
        console.log(`Producto ${title} añadido al carrito`);
        
        const notificacion = document.createElement('div');
        notificacion.className = 'fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-md shadow-lg z-50 animate-fade-in-out';
        notificacion.textContent = '¡Producto añadido al carrito!';
        document.body.appendChild(notificacion);
        
        setTimeout(() => notificacion.remove(), 3000);
      });
    });
  });
</script>